#include "FreeRTOS.h"
#include "task.h"
#include "stm32l476xx.h"

volatile int LEDState=0;
const uint16_t sinLUT[] = {
0x800, 0x8c9, 0x990, 0xa53, 0xb10, 0xbc5, 0xc72, 0xd13,
0xda8, 0xe2f, 0xea7, 0xf0e, 0xf64, 0xfa8, 0xfd9, 0xff6,
0x1000, 0xff6, 0xfd9, 0xfa8, 0xf64, 0xf0e, 0xea7, 0xe2f,
0xda8, 0xd13, 0xc72, 0xbc5, 0xb10, 0xa53, 0x990, 0x8c9,
0x800, 0x737, 0x670, 0x5ad, 0x4f0, 0x43b, 0x38e, 0x2ed,
0x258, 0x1d1, 0x159, 0xf2, 0x9c, 0x58, 0x27, 0x0a,
0x00, 0x0a, 0x27, 0x58, 0x9c, 0xf2, 0x159, 0x1d1,
0x258, 0x2ed, 0x38e, 0x43b, 0x4f0, 0x5ad, 0x670, 0x737};

int main (void) {
	//gpio setup
	RCC->AHB2ENR |= RCC_AHB2ENR_GPIOAEN | RCC_AHB2ENR_GPIOCEN;
	GPIOA->MODER &= 0xFFFFF3FF;
	GPIOA->MODER |= 0x00000400;
	GPIOC->MODER &= 0xF3FFFFFF;
	
	//gpio pin for dac output
	GPIOA->MODER |= 3U<<(2*5);

	//register tasks
	xTaskCreate(
		LEDTask,
		"LEDTask",
		32,
		NULL,
		1,
		NULL
	);
	
	xTaskCreate(
		BTNTask,
		"BTNTask",
		32,
		NULL,
		1,
		NULL
	);
	
	vTaskStartScheduler();
	
	for( ;; );
	return 0;
}
